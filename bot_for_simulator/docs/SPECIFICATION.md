### Исправленная Спецификация Бота  

---

#### 1. Требования  
1. Взаимодействие **только через `/command`**  
2. Управление **одним агентом**  
3. Мультипроцессинг **только для визуализации**  

---

#### 2. Компоненты бота  
**1. HTTP Клиент**  
- Отправка команд на сервер  
- При ошибках: повтор через 1 сек (без ограничений)  
- Адреса жестко зашиты в коде  

**2. Парсер состояния**  
- Извлекает:  
  - Позицию агента (`agent.x`, `agent.y`)  
  - Видимые NPC/ресурсы/препятствия  
  - Счет (`score`) и жизни (`respawns`)  
  - **Радиус видимости** (константа `VISION_RADIUS = 5`)  

**3. Алгоритм принятия решений**  
- Функция вида:  
  ```python
  command_body, viz_data = algorithm(parsed_state)
  ```  
  - `command_body`: готовый JSON для отправки  
  - `viz_data`: произвольные данные для визуализатора  

**4. Визуализатор (отдельный процесс)**  
- Получает через очередь:  
  - `parsed_state` (текущее состояние)  
  - `viz_data` (дополнительные данные от алгоритма)  
- Отображает только:  
  - Позиции агента/NPC/ресурсов/препятствий  
  - Радиус видимости  
  - Текущий счет  

---

#### 3. Рабочий цикл  
1. **Получить состояние**: запрос к `/command`  
2. **Распарсить**: извлечь ключевые данные  
3. **Принять решение**: вызов функции алгоритма  
4. **Отправить команду**: `command_body` напрямую на сервер  
5. **Обновить визуализацию**: передать `(parsed_state, viz_data)`  

---

#### 4. Визуализация (PyGame)  
**Отображаемые элементы**:  
- Агент: синий квадрат  
- NPC: красные квадраты  
- Ресурсы: зеленые круги  
- Препятствия: серые полигоны  
- Радиус видимости: полупрозрачный круг  
- Текстовый HUD: счет и жизни  

**Технические параметры**:  
- Размер окна: 800x600  
- Частота обновления: 30 FPS  

---

### Обновлённая спецификация (раздел 5) с классом вместо функции:

---

#### 5. Алгоритмический модуль  
**Реализация через класс**:  
```python
class BotAI:
    def __init__(self, config=None):
        """
        Инициализация внутреннего состояния бота
        config: словарь с конфигурационными параметрами (опционально)
        """
        self.config = config or {}
        # Внутреннее состояние (история, цели и т.д.)

    def step(self, state: dict) -> (dict, any):
        """
        Основной метод, вызываемый на каждом такте
        
        Args:
            state: распарсенное состояние игры (словарь)
            
        Returns:
            tuple: 
                - command_body (dict): готовый JSON для отправки
                - viz_data (any): произвольные данные для визуализатора
        """
        # Логика принятия решений...
        command = {"command": "move", "direction": "left"}
        
        # Данные для визуализации (например, путь)
        viz_data = {"path": [(5,5), (6,5), (7,5)]}
        
        return command, viz_data
```

**Выходные данные**:  
- `command_body`: готовый JSON для отправки (например `{"command": "move", "direction": "left"}`)  
- `viz_data`: любые данные для отрисовки (например словарь с путём, целями и т.п.)

**Требования к реализации**:  
1. Класс должен иметь метод `__init__` для инициализации  
2. Основная логика реализуется в методе `step()`  
3. Метод `step()` принимает распарсенное состояние и возвращает команду + данные визуализации  
4. Внутреннее состояние сохраняется между вызовами  
5. Обработка ошибок должна происходить внутри класса  

---

#### 6. Обработка ошибок  
1. **Ошибка сети/сервера**:  
   - Повтор запроса через 1 сек  
2. **Ошибка алгоритма**:  
   - Отправка резервной команды: `{"command": "attack"}`  
3. **Критическая ошибка**:  
   - Немедленная остановка бота  

---

#### 7. Протокол работы  
1. Ручная инициализация игры через Postman  
2. Запуск бота:  
   ```bash
   python bot.py
   ```  
3. Серверные адреса зашиты в коде:  
   ```python
   SERVER_URL = "http://localhost:5000/command"
   ```

---

#### 8. Форматы данных  
**Отправляемая команда (готовый JSON)**:  
`POST /command`
```json
// Для движения:
{"command": "move", "direction": "left"}

// Для атаки:
{"command": "attack"}
```

**Ответ**:
```json
{
  "width": 50,
  "height": 50,
  "score": 115,
  "respawns": 1,
  "agent": {"x": 10, "y": 5},
  "visible_entities": {
    "npcs": [{"x": 12, "y": 5}],
    "resources": [{"x": 8, "y": 5}],
    "obstacles": [{"x": 5, "y": 5}]
  }
}
```

**Данные для визуализатора**:  
Произвольный объект, например:  
```python
{
  "target": (15, 20),
  "path": [(5,5), (6,5), (7,5)],
  "danger_zones": [(12,12), (13,12)]
}
```

